{
  "name": "Mantiséšœå®³æ•°æ®-æ™ºèƒ½åŒæ­¥V2.0.0",
  "nodes": [
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT COALESCE(MAX(last_synced_bug_id), 0) AS max_synced_bug_id FROM mantis.sync_log WHERE sync_status = 'SUCCESS' AND sync_type = 'INCREMENTAL';",
        "options": {}
      },
      "id": "49850cbb-b02f-4a9e-981d-fa2c78f7d2ee",
      "name": "æŸ¥è¯¢å·²åŒæ­¥çš„æœ€å¤§BugID",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.1,
      "position": [
        -1968,
        272
      ],
      "credentials": {
        "postgres": {
          "id": "tWcUIJhVg6bDlGDc",
          "name": "TargetDB"
        }
      },
      "onError": "continueErrorOutput",
      "notes": "ä»sync_logè¡¨è·å–ä¸Šæ¬¡æˆåŠŸåŒæ­¥çš„æœ€å¤§bug_idï¼Œé¿å…æ•°æ®é—æ¼"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "INSERT INTO mantis.sync_log (sync_type, sync_status, start_time) VALUES ('INCREMENTAL', 'RUNNING', NOW()) RETURNING id as sync_log_id;",
        "options": {}
      },
      "id": "b1a1fc35-2e3f-49bb-8294-e3ad9369b789",
      "name": "åˆ›å»ºåŒæ­¥æ—¥å¿—",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.1,
      "position": [
        -1792,
        256
      ],
      "credentials": {
        "postgres": {
          "id": "tWcUIJhVg6bDlGDc",
          "name": "TargetDB"
        }
      },
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "jsCode": "// å‡†å¤‡æŸ¥è¯¢å‚æ•°ï¼šä»æœ€å¤§bug_id+1å¼€å§‹åŒæ­¥\nconst maxBugId = $('æŸ¥è¯¢å·²åŒæ­¥çš„æœ€å¤§BugID').first().json.max_synced_bug_id || 0;\nconst syncLogId = $('åˆ›å»ºåŒæ­¥æ—¥å¿—').first().json.sync_log_id;\n\nreturn [{\n  json: {\n    max_synced_bug_id: maxBugId,\n    sync_log_id: syncLogId,\n    offset: 0\n  }\n}];"
      },
      "id": "81070bae-b8ec-4e24-a91f-a14c9c6070ca",
      "name": "å‡†å¤‡æŸ¥è¯¢å‚æ•°",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1616,
        240
      ],
      "onError": "continueErrorOutput",
      "notes": "ä»æœ€å¤§bug_idå¼€å§‹æŸ¥è¯¢ï¼ŒåªåŒæ­¥æ–°å¢æ•°æ®"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "WITH target_bugs AS (\n  SELECT id, {{ $json.offset || 0 }} AS query_offset\n  FROM mantis_bug_table\n  WHERE status = 85\n    AND id > {{ $json.max_synced_bug_id || 0 }}\n  ORDER BY id\n  LIMIT 500 OFFSET {{ $json.offset || 0 }}\n),\nlatest_history AS (\n  SELECT\n    bug_id,\n    field_name,\n    new_value,\n    ROW_NUMBER() OVER (PARTITION BY bug_id, field_name ORDER BY date_modified DESC, id DESC) AS rn\n  FROM mantis_bug_history_table\n  WHERE bug_id IN (SELECT id FROM target_bugs)\n    AND field_name IN (\n      'ç¢ºèªè€…(ãƒ†ã‚¹ãƒˆ)', 'ç¢ºèªæ—¥(ãƒ†ã‚¹ãƒˆ)',\n      'èª¿æŸ»è€…', 'èª¿æŸ»æ—¥',\n      'ä¿®æ­£è€…', 'ä¿®æ­£æ—¥',\n      'ãƒã‚°åˆ†é¡', 'ãƒã‚°åŒºåˆ†', 'é–¢é€£ã‚³ãƒãƒ³ãƒ‰',\n      'åŸå› åŒºåˆ†(å¤§)', 'åŸå› åŒºåˆ†(å°)',\n      'éšœå®³ç™ºç”ŸåŸå› ', 'ä¿®æ­£å†…å®¹'\n    )\n),\nhistory_pivot AS (\n  SELECT\n    bug_id,\n    MAX(CASE WHEN field_name = 'ç¢ºèªè€…(ãƒ†ã‚¹ãƒˆ)' THEN new_value END) AS test_confirmer_name,\n    MAX(CASE WHEN field_name = 'ç¢ºèªæ—¥(ãƒ†ã‚¹ãƒˆ)' THEN new_value END) AS test_confirmed_ts,\n    MAX(CASE WHEN field_name = 'èª¿æŸ»è€…' THEN new_value END) AS investigator,\n    MAX(CASE WHEN field_name = 'èª¿æŸ»æ—¥' THEN new_value END) AS investigated_ts,\n    MAX(CASE WHEN field_name = 'ä¿®æ­£è€…' THEN new_value END) AS fixer,\n    MAX(CASE WHEN field_name = 'ä¿®æ­£æ—¥' THEN new_value END) AS fixed_ts,\n    MAX(CASE WHEN field_name = 'ãƒã‚°åˆ†é¡' THEN new_value END) AS bug_category_jp,\n    MAX(CASE WHEN field_name = 'ãƒã‚°åŒºåˆ†' THEN new_value END) AS bug_classification,\n    MAX(CASE WHEN field_name = 'é–¢é€£ã‚³ãƒãƒ³ãƒ‰' THEN new_value END) AS related_command,\n    MAX(CASE WHEN field_name = 'åŸå› åŒºåˆ†(å¤§)' THEN new_value END) AS cause_large,\n    MAX(CASE WHEN field_name = 'åŸå› åŒºåˆ†(å°)' THEN new_value END) AS cause_small,\n    MAX(CASE WHEN field_name = 'éšœå®³ç™ºç”ŸåŸå› ' THEN new_value END) AS root_cause_text,\n    MAX(CASE WHEN field_name = 'ä¿®æ­£å†…å®¹' THEN new_value END) AS fix_detail_text\n  FROM latest_history\n  WHERE rn = 1\n  GROUP BY bug_id\n)\nSELECT\n  b.id AS bug_id,\n  LPAD(CAST(b.id AS CHAR), 7, '0') AS bug_no_for_ui,\n  p.name AS project_name,\n  CASE b.view_state\n    WHEN 10 THEN 'å…¬é–‹'\n    WHEN 50 THEN 'éå…¬é–‹'\n    ELSE CONCAT('view_state_', b.view_state)\n  END AS view_state_name,\n  FROM_UNIXTIME(b.date_submitted) AS registered_at,\n  FROM_UNIXTIME(b.last_updated) AS last_updated_at,\n  CONCAT_WS('_', hu.username, hu.realname) AS handler_display,\n  CONCAT_WS('_', ru.username, ru.realname) AS reporter_display,\n  CASE b.status\n    WHEN 10 THEN 'new' WHEN 20 THEN 'feedback' WHEN 30 THEN 'acknowledged' WHEN 40 THEN 'confirmed'\n    WHEN 50 THEN 'assigned' WHEN 77 THEN 'èª¿æŸ»ä¸­' WHEN 78 THEN 'ä¿®æ­£ä¸­' WHEN 80 THEN 'resolved'\n    WHEN 85 THEN 'ç¢ºèªæ¸ˆ' WHEN 90 THEN 'closed' ELSE CAST(b.status AS CHAR)\n  END AS status_name,\n  CASE b.priority\n    WHEN 10 THEN 'none' WHEN 20 THEN 'low' WHEN 30 THEN 'normal' WHEN 40 THEN 'high'\n    WHEN 50 THEN 'urgent' WHEN 60 THEN 'immediate' ELSE CAST(b.priority AS CHAR)\n  END AS priority_name,\n  CASE b.severity\n    WHEN 10 THEN 'feature' WHEN 20 THEN 'trivial' WHEN 30 THEN 'text' WHEN 40 THEN 'tweak'\n    WHEN 50 THEN 'minor' WHEN 60 THEN 'major' WHEN 70 THEN 'crash' WHEN 80 THEN 'block'\n    ELSE CAST(b.severity AS CHAR)\n  END AS severity_name,\n  b.reproducibility,\n  b.summary,\n  bt.description AS detail_description,\n  c.name AS category_name,\n  hp.investigator,\n  FROM_UNIXTIME(CAST(hp.investigated_ts AS UNSIGNED)) AS investigated_at,\n  hp.fixer,\n  FROM_UNIXTIME(CAST(hp.fixed_ts AS UNSIGNED)) AS fixed_at,\n  NULLIF(TRIM(hp.bug_category_jp), '') AS bug_category_jp,\n  NULLIF(TRIM(hp.bug_classification), '') AS bug_classification,\n  NULLIF(TRIM(hp.related_command), '') AS related_command,\n  NULLIF(TRIM(hp.cause_large), '') AS cause_large,\n  NULLIF(TRIM(hp.cause_small), '') AS cause_small,\n  hp.root_cause_text,\n  hp.fix_detail_text,\n  tb.query_offset AS current_offset\nFROM target_bugs tb\nJOIN mantis_bug_table b ON b.id = tb.id\nLEFT JOIN mantis_project_table p ON p.id = b.project_id\nLEFT JOIN mantis_user_table hu ON hu.id = b.handler_id\nLEFT JOIN mantis_user_table ru ON ru.id = b.reporter_id\nLEFT JOIN mantis_bug_text_table bt ON bt.id = b.bug_text_id\nLEFT JOIN mantis_category_table c ON c.id = b.category_id\nLEFT JOIN history_pivot hp ON hp.bug_id = b.id\nORDER BY b.id;",
        "options": {}
      },
      "id": "0ba97c41-1356-4eef-a780-a39c429f0c67",
      "name": "æŸ¥è¯¢å¾…åŒæ­¥æ•°æ®",
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.1,
      "position": [
        -1408,
        224
      ],
      "credentials": {
        "mySql": {
          "id": "JN4ZRi7Xi3HQr9k7",
          "name": "SourceDB"
        }
      },
      "onError": "continueErrorOutput",
      "notes": "æ¯æ‰¹æŸ¥è¯¢500æ¡ï¼Œåç»­é€æ¡æ’å…¥é¿å…å‚æ•°é™åˆ¶"
    },
    {
      "parameters": {
        "conditions": {
          "number": [
            {
              "value1": "={{ $items(\"æŸ¥è¯¢å¾…åŒæ­¥æ•°æ®\").length }}",
              "operation": "larger"
            }
          ]
        }
      },
      "id": "bdc45b5c-ca3c-4b3d-8eff-cf624eeff6f4",
      "name": "åˆ¤æ–­æ˜¯å¦æœ‰æ•°æ®",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [
        -1184,
        208
      ]
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "={{ $items('æŸ¥è¯¢å¾…åŒæ­¥æ•°æ®').length > 0 ? 'SELECT bug_id FROM mantis.bug_analysis WHERE bug_id = ANY(ARRAY[' + $items('æŸ¥è¯¢å¾…åŒæ­¥æ•°æ®').map(item => item.json.bug_id).join(',') + ']::INTEGER[]);' : 'SELECT 0 AS bug_id WHERE FALSE;' }}",
        "options": {}
      },
      "id": "8fe6fdca-2080-45b0-be1a-62d50c625051",
      "name": "æŸ¥è¯¢å·²å­˜åœ¨çš„BugIDåˆ—è¡¨",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.1,
      "position": [
        -928,
        80
      ],
      "credentials": {
        "postgres": {
          "id": "tWcUIJhVg6bDlGDc",
          "name": "TargetDB"
        }
      },
      "onError": "continueErrorOutput",
      "notes": "æŸ¥è¯¢ç›®æ ‡è¡¨ä¸­å·²å­˜åœ¨çš„bug_idï¼Œç”¨äºè¿‡æ»¤"
    },
    {
      "parameters": {
        "jsCode": "// è¿‡æ»¤æ‰å·²å­˜åœ¨çš„bug_idï¼Œåªä¿ç•™æ–°æ•°æ®\nconst sourceItems = $items(\"æŸ¥è¯¢å¾…åŒæ­¥æ•°æ®\");\nconst existingBugIds = new Set(\n  $items(\"æŸ¥è¯¢å·²å­˜åœ¨çš„BugIDåˆ—è¡¨\").map(item => item.json.bug_id)\n);\n\n// è¿‡æ»¤å‡ºä¸å­˜åœ¨çš„bug_id\nconst newItems = sourceItems.filter(item => {\n  const bugId = item.json.bug_id;\n  return !existingBugIds.has(bugId);\n});\n\nconst newCount = newItems.length;\nconst totalCount = sourceItems.length;\nconst skippedCount = totalCount - newCount;\n\nconsole.log(`æ€»æ•°æ®: ${totalCount}, å·²å­˜åœ¨(è·³è¿‡): ${skippedCount}, æ–°æ•°æ®: ${newCount}`);\n\n// å§‹ç»ˆè¿”å›æ•°æ®ï¼Œä½†æ ‡è®°æ˜¯å¦æœ‰æ–°æ•°æ®\nif (newCount === 0) {\n  // æ²¡æœ‰æ–°æ•°æ®æ—¶ï¼Œè¿”å›ä¸€ä¸ªæ ‡è®°å¯¹è±¡ç”¨äºç»§ç»­æµç¨‹\n  return [{\n    json: {\n      has_new_data: false,\n      skipped_count: skippedCount,\n      message: 'æ‰€æœ‰æ•°æ®å·²å­˜åœ¨ï¼Œè·³è¿‡æ’å…¥'\n    }\n  }];\n}\n\n// æœ‰æ–°æ•°æ®æ—¶ï¼Œä¸ºæ¯ä¸ªitemæ·»åŠ æ ‡è®°\nreturn newItems.map(item => ({\n  json: {\n    ...item.json,\n    has_new_data: true\n  }\n}));"
      },
      "id": "3f0f5058-ed89-4b24-936b-5886b977057f",
      "name": "è¿‡æ»¤æ–°æ•°æ®",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -688,
        64
      ],
      "onError": "continueErrorOutput",
      "notes": "è¿‡æ»¤æ‰å·²å­˜åœ¨çš„bug_idï¼Œåªæ’å…¥æ–°æ•°æ®ï¼Œé¿å…å”¯ä¸€é”®å†²çª"
    },
    {
      "parameters": {
        "conditions": {
          "boolean": [
            {
              "value1": "={{ $json.has_new_data }}",
              "value2": true
            }
          ]
        }
      },
      "id": "24643e7d-814b-4a01-a202-c924ebed30c4",
      "name": "åˆ¤æ–­æ˜¯å¦æœ‰æ–°æ•°æ®è¦æ’å…¥",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [
        -432,
        -16
      ],
      "notes": "å¦‚æœæ²¡æœ‰æ–°æ•°æ®ï¼Œè·³è¿‡æ’å…¥ï¼Œç›´æ¥åˆ¤æ–­æ˜¯å¦ç»§ç»­ä¸‹ä¸€æ‰¹"
    },
    {
      "parameters": {
        "schema": {
          "__rl": true,
          "value": "mantis",
          "mode": "list",
          "cachedResultName": "mantis"
        },
        "table": {
          "__rl": true,
          "value": "bug_analysis",
          "mode": "list",
          "cachedResultName": "bug_analysis"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "bug_id": "={{ $json.bug_id }}",
            "bug_no_for_ui": "={{ $json.bug_no_for_ui }}",
            "project_name": "={{ $json.project_name }}",
            "view_state_name": "={{ $json.view_state_name }}",
            "registered_at": "={{ $json.registered_at }}",
            "last_updated_at": "={{ $json.last_updated_at }}",
            "handler_display": "={{ $json.handler_display }}",
            "reporter_display": "={{ $json.reporter_display }}",
            "status_name": "={{ $json.status_name }}",
            "priority_name": "={{ $json.priority_name }}",
            "severity_name": "={{ $json.severity_name }}",
            "reproducibility": "={{ $json.reproducibility }}",
            "summary": "={{ $json.summary }}",
            "detail_description": "={{ $json.detail_description }}",
            "category_name": "={{ $json.category_name }}",
            "investigator": "={{ $json.investigator }}",
            "investigated_at": "={{ $json.investigated_at }}",
            "fixer": "={{ $json.fixer }}",
            "fixed_at": "={{ $json.fixed_at }}",
            "bug_category_jp": "={{ $json.bug_category_jp }}",
            "bug_classification": "={{ $json.bug_classification }}",
            "related_command": "={{ $json.related_command }}",
            "cause_large": "={{ $json.cause_large }}",
            "cause_small": "={{ $json.cause_small }}",
            "root_cause_text": "={{ $json.root_cause_text }}",
            "fix_detail_text": "={{ $json.fix_detail_text }}"
          },
          "matchingColumns": [
            "bug_id"
          ],
          "schema": []
        },
        "options": {
          "queryBatching": "transaction"
        }
      },
      "id": "2fbb848e-ff0f-4bac-b9a0-178484d3b045",
      "name": "é€æ¡æ’å…¥PostgreSQL",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.4,
      "position": [
        -224,
        -48
      ],
      "credentials": {
        "postgres": {
          "id": "tWcUIJhVg6bDlGDc",
          "name": "TargetDB"
        }
      },
      "onError": "continueErrorOutput",
      "notes": "ä½¿ç”¨åŸç”ŸINSERTèŠ‚ç‚¹é€æ¡æ’å…¥ï¼Œé€šè¿‡matchingColumns=['bug_id']å®ç°UPSERTï¼Œé¿å…ä¸»é”®å†²çª"
    },
    {
      "parameters": {
        "jsCode": "// æ›´æ–°è¿›åº¦å¹¶åˆ¤æ–­æ˜¯å¦ç»§ç»­\nconst syncLogId = $('åˆ›å»ºåŒæ­¥æ—¥å¿—').first().json.sync_log_id;\nconst insertedItems = $('é€æ¡æ’å…¥PostgreSQL').all();\nconst processedCount = insertedItems.length;\n\n// ä»æŸ¥è¯¢ç»“æœè·å–offsetä¿¡æ¯\nconst sourceItems = $('æŸ¥è¯¢å¾…åŒæ­¥æ•°æ®').all();\nconst currentOffset = sourceItems.length > 0 ? sourceItems[0].json.current_offset : 0;\nconst sourceCount = sourceItems.length;  // æŸ¥è¯¢åˆ°çš„åŸå§‹æ•°æ®é‡\n\nconst maxSyncedBugId = $('å‡†å¤‡æŸ¥è¯¢å‚æ•°').first().json.max_synced_bug_id;\n\n// ğŸ”¥ å…³é”®ä¿®å¤: è®¡ç®—æœ¬æ¬¡å®é™…å¤„ç†çš„æœ€å¤§bug_id\nconst processedBugIds = insertedItems.map(item => item.json.bug_id || 0);\nconst currentMaxBugId = processedBugIds.length > 0 ? Math.max(...processedBugIds) : maxSyncedBugId;\n\nconsole.log(`æŸ¥è¯¢åˆ°${sourceCount}æ¡, è¿‡æ»¤åæ’å…¥${processedCount}æ¡, æœ€å¤§bug_id: ${currentMaxBugId}`);\n\n// åˆ¤æ–­æ˜¯å¦ç»§ç»­: åŸºäºæŸ¥è¯¢åˆ°çš„åŸå§‹æ•°æ®é‡,è€Œéæ’å…¥æ•°é‡\nconst shouldContinue = sourceCount >= 500;\n\nreturn [{\n  json: {\n    sync_log_id: syncLogId,\n    records_processed: processedCount,\n    next_offset: currentOffset + 500,\n    should_continue: shouldContinue,\n    max_synced_bug_id: maxSyncedBugId,\n    current_max_bug_id: currentMaxBugId  // æœ¬æ¬¡å¤„ç†çš„æœ€å¤§bug_id\n  }\n}];"
      },
      "id": "77515cf3-caf1-44ec-b474-2cf3e007087a",
      "name": "æ›´æ–°å¤„ç†è¿›åº¦",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        0,
        -64
      ],
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "jsCode": "// æ²¡æœ‰æ–°æ•°æ®æ—¶ï¼Œå‡†å¤‡ç»§ç»­ä¸‹ä¸€æ‰¹çš„å‚æ•°\nconst syncLogId = $('åˆ›å»ºåŒæ­¥æ—¥å¿—').first().json.sync_log_id;\nconst sourceItems = $('æŸ¥è¯¢å¾…åŒæ­¥æ•°æ®').all();\nconst currentOffset = sourceItems.length > 0 ? sourceItems[0].json.current_offset : 0;\nconst sourceCount = sourceItems.length;\nconst maxSyncedBugId = $('å‡†å¤‡æŸ¥è¯¢å‚æ•°').first().json.max_synced_bug_id;\n\nconsole.log(`æœ¬æ‰¹${sourceCount}æ¡æ•°æ®å…¨éƒ¨å·²å­˜åœ¨ï¼Œè·³è¿‡æ’å…¥ï¼Œç»§ç»­ä¸‹ä¸€æ‰¹`);\n\n// åˆ¤æ–­æ˜¯å¦ç»§ç»­\nconst shouldContinue = sourceCount >= 500;\n\nreturn [{\n  json: {\n    sync_log_id: syncLogId,\n    records_processed: 0,  // å®é™…æ’å…¥0æ¡\n    next_offset: currentOffset + 500,\n    should_continue: shouldContinue,\n    max_synced_bug_id: maxSyncedBugId,\n    current_max_bug_id: maxSyncedBugId,  // æ²¡æœ‰æ–°æ•°æ®ï¼Œä¿æŒåŸå€¼\n    skipped: true\n  }\n}];"
      },
      "id": "9a3b444e-db75-4617-aa59-7a363d601576",
      "name": "å‡†å¤‡è·³è¿‡è¿›åº¦",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -368,
        192
      ],
      "onError": "continueErrorOutput",
      "notes": "å½“æœ¬æ‰¹æ•°æ®å…¨éƒ¨å·²å­˜åœ¨æ—¶ï¼Œè·³è¿‡æ’å…¥ä½†ç»§ç»­åˆ¤æ–­ä¸‹ä¸€æ‰¹"
    },
    {
      "parameters": {
        "conditions": {
          "boolean": [
            {
              "value1": "={{ $json.should_continue }}",
              "value2": true
            }
          ]
        }
      },
      "id": "f08d9ac7-f1b0-4bff-8d3f-3edbdad54e1b",
      "name": "åˆ¤æ–­æ˜¯å¦ç»§ç»­",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [
        128,
        112
      ]
    },
    {
      "parameters": {
        "jsCode": "// å‡†å¤‡ä¸‹ä¸€æ‰¹æ¬¡å‚æ•°\nreturn [{\n  json: {\n    offset: $json.next_offset,\n    max_synced_bug_id: $json.max_synced_bug_id,\n    sync_log_id: $json.sync_log_id\n  }\n}];"
      },
      "id": "4953e4ad-112f-46c3-be75-6859c3cffb39",
      "name": "å‡†å¤‡ä¸‹ä¸€æ‰¹",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        352,
        208
      ],
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "UPDATE mantis.sync_log \nSET \n  sync_status = 'SUCCESS',\n  end_time = NOW(),\n  execution_time_seconds = EXTRACT(EPOCH FROM (NOW() - start_time))::INTEGER,\n  last_synced_timestamp = NOW(),\n  last_synced_bug_id = (SELECT MAX(bug_id) FROM mantis.bug_analysis)\nWHERE id = {{ $('åˆ›å»ºåŒæ­¥æ—¥å¿—').first().json.sync_log_id }};",
        "options": {}
      },
      "id": "6fa8da1b-b33d-4db8-91c3-02329816acc1",
      "name": "å®ŒæˆåŒæ­¥æ—¥å¿—",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.1,
      "position": [
        -896,
        464
      ],
      "credentials": {
        "postgres": {
          "id": "tWcUIJhVg6bDlGDc",
          "name": "TargetDB"
        }
      },
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "UPDATE mantis.sync_config \nSET config_value = NOW()::TEXT\nWHERE config_key = 'last_sync_timestamp';",
        "options": {}
      },
      "id": "14ea07c3-79e3-4765-a040-d265622eee71",
      "name": "æ›´æ–°åŒæ­¥é…ç½®",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.1,
      "position": [
        -624,
        448
      ],
      "credentials": {
        "postgres": {
          "id": "tWcUIJhVg6bDlGDc",
          "name": "TargetDB"
        }
      },
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT \n  COUNT(*) as total_records,\n  MAX(last_updated_at) as latest_update,\n  MIN(registered_at) as earliest_create\nFROM mantis.bug_analysis;",
        "options": {}
      },
      "id": "14d08adf-2c99-4dcc-9748-a5c03df64c25",
      "name": "è·å–æœ€ç»ˆç»Ÿè®¡",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.1,
      "position": [
        -368,
        432
      ],
      "credentials": {
        "postgres": {
          "id": "tWcUIJhVg6bDlGDc",
          "name": "TargetDB"
        }
      },
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "hours",
              "hoursInterval": 2
            }
          ]
        }
      },
      "id": "f7bafbb5-af00-43e7-a1b2-fe5901cad811",
      "name": "å®šæ—¶è§¦å‘_æ¯2h",
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.1,
      "position": [
        -2128,
        272
      ],
      "notes": "æ¯2hè‡ªåŠ¨æ‰§è¡Œä¸€æ¬¡ï¼Œå¿«é€ŸåŒæ­¥å­˜é‡æ•°æ®"
    }
  ],
  "pinData": {},
  "connections": {
    "æŸ¥è¯¢å·²åŒæ­¥çš„æœ€å¤§BugID": {
      "main": [
        [
          {
            "node": "åˆ›å»ºåŒæ­¥æ—¥å¿—",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "åˆ›å»ºåŒæ­¥æ—¥å¿—": {
      "main": [
        [
          {
            "node": "å‡†å¤‡æŸ¥è¯¢å‚æ•°",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "å‡†å¤‡æŸ¥è¯¢å‚æ•°": {
      "main": [
        [
          {
            "node": "æŸ¥è¯¢å¾…åŒæ­¥æ•°æ®",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "æŸ¥è¯¢å¾…åŒæ­¥æ•°æ®": {
      "main": [
        [
          {
            "node": "åˆ¤æ–­æ˜¯å¦æœ‰æ•°æ®",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "åˆ¤æ–­æ˜¯å¦æœ‰æ•°æ®": {
      "main": [
        [
          {
            "node": "æŸ¥è¯¢å·²å­˜åœ¨çš„BugIDåˆ—è¡¨",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "å®ŒæˆåŒæ­¥æ—¥å¿—",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "æŸ¥è¯¢å·²å­˜åœ¨çš„BugIDåˆ—è¡¨": {
      "main": [
        [
          {
            "node": "è¿‡æ»¤æ–°æ•°æ®",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "è¿‡æ»¤æ–°æ•°æ®": {
      "main": [
        [
          {
            "node": "åˆ¤æ–­æ˜¯å¦æœ‰æ–°æ•°æ®è¦æ’å…¥",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "åˆ¤æ–­æ˜¯å¦æœ‰æ–°æ•°æ®è¦æ’å…¥": {
      "main": [
        [
          {
            "node": "é€æ¡æ’å…¥PostgreSQL",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "å‡†å¤‡è·³è¿‡è¿›åº¦",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "é€æ¡æ’å…¥PostgreSQL": {
      "main": [
        [
          {
            "node": "æ›´æ–°å¤„ç†è¿›åº¦",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "æ›´æ–°å¤„ç†è¿›åº¦": {
      "main": [
        [
          {
            "node": "åˆ¤æ–­æ˜¯å¦ç»§ç»­",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "å‡†å¤‡è·³è¿‡è¿›åº¦": {
      "main": [
        [
          {
            "node": "åˆ¤æ–­æ˜¯å¦ç»§ç»­",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "åˆ¤æ–­æ˜¯å¦ç»§ç»­": {
      "main": [
        [
          {
            "node": "å‡†å¤‡ä¸‹ä¸€æ‰¹",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "å®ŒæˆåŒæ­¥æ—¥å¿—",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "å‡†å¤‡ä¸‹ä¸€æ‰¹": {
      "main": [
        [
          {
            "node": "æŸ¥è¯¢å¾…åŒæ­¥æ•°æ®",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "å®ŒæˆåŒæ­¥æ—¥å¿—": {
      "main": [
        [
          {
            "node": "æ›´æ–°åŒæ­¥é…ç½®",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "æ›´æ–°åŒæ­¥é…ç½®": {
      "main": [
        [
          {
            "node": "è·å–æœ€ç»ˆç»Ÿè®¡",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "å®šæ—¶è§¦å‘_æ¯2h": {
      "main": [
        [
          {
            "node": "æŸ¥è¯¢å·²åŒæ­¥çš„æœ€å¤§BugID",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "1bbb121d-750b-4a52-95d6-fd67cca005bb",
  "meta": {
    "instanceId": "1003d7a4418464b97d5dcd6234164bb132b89fde605b38f31cba0abf5a7b1b81"
  },
  "id": "j6DvFoiJD7jppoWK",
  "tags": [
    {
      "createdAt": "2025-10-10T08:32:49.722Z",
      "updatedAt": "2025-10-10T08:32:49.722Z",
      "id": "LzKc1zENSTrzLIN6",
      "name": "MantisåŒæ­¥"
    }
  ]
}